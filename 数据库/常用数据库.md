# 常用数据库

## MySQL

### 存储引擎
在MySQL 5.5之前，MyISAM是mysql的默认数据库引擎，其由早期的ISAM（Indexed Sequential Access Method：有索引的顺序访问方法）所改良。虽然MyISAM性能极佳，但却有一个显著的缺点： 不支持事务处理。不过，MySQL也导入了另一种数据库引擎InnoDB，以强化参考完整性与并发违规处理机制，后来就逐渐取代MyISAM。

　　InnoDB是MySQL的数据库引擎之一，其由Innobase oy公司所开发，2006年五月由甲骨文公司并购。与传统的ISAM、MyISAM相比，InnoDB的最大特色就是支持ACID兼容的事务功能，类似于PostgreSQL。目前InnoDB采用双轨制授权，一是GPL授权，另一是专有软件授权。具体地，MyISAM与InnoDB作为MySQL的两大存储引擎的差异主要包括：

存储结构：每个MyISAM在磁盘上存储成三个文件：第一个文件的名字以表的名字开始，扩展名指出文件类型。.frm文件存储表定义，数据文件的扩展名为.MYD (MYData)，索引文件的扩展名是.MYI (MYIndex)。InnoDB所有的表都保存在同一个数据文件中（也可能是多个文件，或者是独立的表空间文件），InnoDB表的大小只受限于操作系统文件的大小，一般为2GB。

存储空间：MyISAM可被压缩，占据的存储空间较小，支持静态表、动态表、压缩表三种不同的存储格式。InnoDB需要更多的内存和存储，它会在主内存中建立其专用的缓冲池用于高速缓冲数据和索引。

可移植性、备份及恢复：MyISAM的数据是以文件的形式存储，所以在跨平台的数据转移中会很方便，同时在备份和恢复时也可单独针对某个表进行操作。InnoDB免费的方案可以是拷贝数据文件、备份 binlog，或者用 mysqldump，在数据量达到几十G的时候就相对痛苦了。

事务支持：MyISAM强调的是性能，每次查询具有原子性，其执行数度比InnoDB类型更快，但是不提供事务支持。InnoDB提供事务、外键等高级数据库功能，具有事务提交、回滚和崩溃修复能力。

AUTO_INCREMENT：在MyISAM中，可以和其他字段一起建立联合索引。引擎的自动增长列必须是索引，如果是组合索引，自动增长可以不是第一列，它可以根据前面几列进行排序后递增。InnoDB中必须包含只有该字段的索引，并且引擎的自动增长列必须是索引，如果是组合索引也必须是组合索引的第一列。

表锁差异：MyISAM只支持表级锁，用户在操作MyISAM表时，select、update、delete和insert语句都会给表自动加锁，如果加锁以后的表满足insert并发的情况下，可以在表的尾部插入新的数据。InnoDB支持事务和行级锁。行锁大幅度提高了多用户并发操作的新能，但是InnoDB的行锁，只是在WHERE的主键是有效的，非主键的WHERE都会锁全表的。

全文索引：MyISAM支持 FULLTEXT类型的全文索引；InnoDB不支持FULLTEXT类型的全文索引，但是innodb可以使用sphinx插件支持全文索引，并且效果更好。

表主键：MyISAM允许没有任何索引和主键的表存在，索引都是保存行的地址。对于InnoDB，如果没有设定主键或者非空唯一索引，就会自动生成一个6字节的主键(用户不可见)，数据是主索引的一部分，附加索引保存的是主索引的值。

表的具体行数：MyISAM保存表的总行数，select count() from table;会直接取出出该值；而InnoDB没有保存表的总行数，如果使用select count() from table；就会遍历整个表，消耗相当大，但是在加了wehre条件后，myisam和innodb处理的方式都一样。

CURD操作：在MyISAM中，如果执行大量的SELECT，MyISAM是更好的选择。对于InnoDB，如果你的数据执行大量的INSERT或UPDATE，出于性能方面的考虑，应该使用InnoDB表。DELETE从性能上InnoDB更优，但DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的删除，在innodb上如果要清空保存有大量数据的表，最好使用truncate table这个命令。

外键：MyISAM不支持外键，而InnoDB支持外键。

　　通过上述的分析，基本上可以考虑使用InnoDB来替代MyISAM引擎了，原因是InnoDB自身很多良好的特点，比如事务支持、存储过程、视图、行级锁、外键等等。尤其在并发很多的情况下，相信InnoDB的表现肯定要比MyISAM强很多。另外，必须需要注意的是，任何一种表都不是万能的，合适的才是最好的，才能最大的发挥MySQL的性能优势。如果是不复杂的、非关键的Web应用，还是可以继续考虑MyISAM的，这个具体情况具体考虑。

### MySQL并发（事务、隔离级别、锁）

### MySQL中char、varchar和text的区别

### MySQL的慢查询日志
* MySQL的慢查询日志用来记录响应时间超过阀值的查询操作，通过该日志可以找出有问题的SQL语句。
* 相关参数：
    * slow_query_log：是否开启慢查询日志。
    * long_query_time：慢查询阀值，当查询时间多于设定的阀值时，记录日志。
    * log_queries_not_using_indexes：未使用索引的查询也被记录到慢查询日志中。
    * log_output：日志存储方式，可以文件形式存储，也可以存入数据库，还可以两者同时启用。

### MySQL的explain命令
* MySQL的explain命令用于查看执行查询效果，展示了MySQL如何使用索引来处理select语句以及连接表，可以帮助选择更好的索引和写出更优化的查询语句。
* 使用方法：在select语句前加上explain，如explain select * from user;。
* 结果中每一列的解释：
    * id：表示select查询序列号，代表SQL语句执行的顺序。
    * select_type：表示查询类型，包括simple、primary、union、dependent union和union result。
    * table：表示该行数据是关于哪张表的。
    * type：表示连接使用了什么类型，从好到坏依次为const、eq_reg、ref、range、index和ALL。
    * possible_keys：表示可能应用在这张表中的索引，如果为空则表示没有可用的索引。
    * key：表示查询中实际使用的索引，如果为空则表示没有使用索引。
    * key_len：表示使用的索引的长度，在不损失精确性的情况下，长度越短越好。
    * ref：表示索引的哪一列被使用了，如果可能的话是一个常数。
    * rows：表示返回查询结果必须检查的数据行数，数值越大越不好，说明没有用好索引。
    * extra：表示MySQL如何解析查询的额外信息。

## Redis

### 概述
* Redis是一个key-value存储系统，它的数据存储在内存中，读取效率极高，常被用作缓存。
* Redis支持事务，具有事务的四大特性ACID。
* Redis有丰富的特性：可用于缓存、消息，还可以按key设置过期时间，过期后将会自动删除。

### 支持的数据类型
* String：字符串。
* List：有序、可重复的列表。
* Set：无序、不可重复的集合。
* SortedSet：排序的不可重复的集合。
* Hash：对象。

### Redis的内存回收策略
* volatile-lru：从过期数据集中挑选最近最少使用的数据淘汰。
* volatile-ttl：从过期数据集中挑选将要过期的数据淘汰。
* volatile-random：从过期数据集中随机选择数据淘汰。
* allkeys-lru：从所有数据集中挑选最近最少使用的数据淘汰。
* allkeys-random：从所有数据集中随机选择数据淘汰。

> 内存回收发生时机：Redis数据过多导致内存即将占满。

### Redis相对于Memcached的优势
* Memcached的值都是简单的字符串，而Redis支持丰富的数据类型。
* Redis的速度比Memcached快。
* Redis可以持久化存储数据。

